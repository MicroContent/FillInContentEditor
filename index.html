<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FillInEditor</title>
    <script type="application/javascript">
        function init() {
            window.data = getData();
            setDataGetter(dataGetter)
        }
    </script>
</head>
<body>
    <div id="content">
        <p>
            <label for="titleInput">Enter Title:</label>
            <input id="titleInput" type="text" />
        </p>
        <p>
            <label for="questionInput">Enter question:</label>
            <input id="questionInput" type="text"/>
        </p>
        <p>
            <label for="fillintext">Text to fill in:</label>
            <textarea id="fillintext" type="text"></textarea>
        </p>
        <p>
            <label for="hintInput">Enter hint:</label>
            <textarea id="hintInput"></textarea>
        </p>
        <p>
            <label for="explanationInput">Enter explanation:</label>
            <textarea id="explanationInput"></textarea>
         </p>
    </div>
    <script type="application/javascript">
        function dataGetter() {
            var lastEdit = Date.now();
            
            return {
                // return data object
                title: document.getElementById('titleInput').value,
                priority: 1,
                type: 'FillIN',
                question: document.getElementById('questionInput').value,
                fillintext: document.getElementById('fillintext').value,
                questionContext: document.getElementById('hintInput').value,
                answerContext: document.getElementById('explanationInput').value,
                lastEdit: lastEdit,
                answers: extractAnswersToArray(document.getElementById('fillintext').value),
                id: 0,
                lessonId: 0,
                releaseStatus: 'PUBLIC',
                editable: null,
                learningStatus: 0,
                skipStatus: 'NEVER_SKIPPABLE',
                multimedia: [],
                // preview metadata
                description: replacePossibleAnswers(document.getElementById('fillintext').value),
            }
        }

        function replacePossibleAnswers (string) {
            var re = /\[(.*?)\]/g;
            var toReplace = string.match(re);
            var emptyArray = []

            for (var i = 0; i<toReplace.length; i++) {
                string = string.replace(toReplace[i], "(" + (i+1) + ")")
            }
            if (extractAnswersToArray(string).length == 0 ) return emptyArray;
            return string;
        }

        function extractAnswersToArray (string) {
            var a = [];
            var re = /\[(.*?)\]/g;
            var uglyArray = string.match(re);
            for (var i = 0; i<uglyArray.length; i++) {
                var b = uglyArray[i].replace(/[\[\]']+/g,"").split("|");
                for (var j = 0; j < b.length; j++) {
                    b[j] = b[j].trim;
                }
                a.push(b);
            }
            return a;
        }

        init();
        document.getElementById('titleInput').value = window.data.title;
        document.getElementById('questionInput').value = window.data.question;
        document.getElementById('fillintext').value = window.data.fillintext;
        document.getElementById('hintInput').value = window.data.questionContext;
        document.getElementById('explanationInput').value = window.data.answerContext;
    </script>
</body>
</html>